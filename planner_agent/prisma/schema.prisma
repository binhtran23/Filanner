generator client {
  provider             = "prisma-client-py"
  interface            = "asyncio"          // Bắt buộc để dùng async/await trong FastAPI
  recursive_type_depth = 5
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model FinancePlan {
  id        String   @id @default(uuid())
  userId    Int?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  plans planExchange[]

  @@index([userId])
  @@map("finance_plan")
}

enum RequestStatus {
  PENDING     // Vừa nhận request
  PROCESSING  // AI đang chạy
  COMPLETED   // Đã xong
  FAILED      // Lỗi
}

model planExchange {
  id        Int      @id @default(autoincrement())

  financePlanId String
  financePlan   FinancePlan @relation(fields: [financePlanId], references: [id], onDelete: Cascade)
  
  // --- CONTENT ---
  plan  String?  @db.Text

  // --- METADATA & COST ---
  responseTime     Int     // ms
  successCode      Int     @default(200)
  errorMessage     String? @db.Text
  status    RequestStatus @default(PENDING)
  
  promptTokens     Int?
  completionTokens Int?
  totalTokens      Int?

  createdAt DateTime @default(now())

  @@index([financePlanId])
}